import{g as Q,r as u,ae as W,i as P,j as X,k as Y,l as Z,c as S,a as i,b as o,z as ee,n as l,w as r,t as T,af as j,F as ae,o as $,h as y,a1 as N,d as b,ag as se,e as le}from"./C05GwoDL.js";import{c as oe,a as U,_ as te,d as ne,e as z}from"./CQSpQtXM.js";import{_ as re,d as ie,e as de}from"./BYtzin4T.js";import{a as ue,_ as ce}from"./B1Gs7JgN.js";import{u as me}from"./BVRkdi-0.js";const fe={class:"mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8"},pe={key:0,class:"flex items-center justify-center pt-10 w-full"},_e={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ge={class:"flex justify-between items-center"},ve={class:"flex justify-end items-center gap-4"},ye={key:2},be={class:"grid md:grid-cols-2 gap-4 border-b pb-4 border-gray-200"},xe={class:"flex justify-end gap-2"},we={class:"text-sm text-gray-600 border-b pb-4 border-gray-200"},Ue={class:"flex justify-end gap-2 mt-3"},Ae={__name:"index",setup(he){const V=me(),B=Q(),C=u([]),c=u(!1),d=u(!1),x=u(!1),f=W(),m=u(!1),p=P(()=>B.query.id),D=u(""),_=u(""),k=u(!1),g=u({id:null,name:"",email:"",phone:"",address:"",agreed_amount:""}),I=oe({name:U().required("Name is required"),email:U().email("Invalid email").nullable(),phone:U().nullable(),address:U().nullable(),agreed_amount:U().nullable()}),s=X({...g.value}),K=async a=>{c.value=!0;const e=s.id?`/collage_ap/${p.value}/user/${s.id}`:`/collage_ap/${p.value}/user`,A=s.id?"PUT":"POST";delete a.data.id;try{const n=await V(e,{method:A,body:a.data});n?.success?(d.value=!1,f.add({title:"Success",description:n?.msg?n?.msg:s.id?"User updated successfully":"User created successfully",color:"success",duration:2e3}),s.id=null,await h()):n?._data?.msg?f.add({title:"Failed",description:n._data.msg,color:"error"}):f.add({title:"Unexpected Response",description:"Something went wrong. Please try again.",color:"error"})}catch(n){console.error("Submission error:",n),f.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}finally{d.value=!1,E(),c.value=!1}},E=()=>{Object.assign(g.value,{id:null,name:"",email:"",phone:"",address:"",agreed_amount:""}),Object.assign(s,g.value)},M=a=>{g.value.id=a.id,s.id=a.id,s.name=a.c_user_name,s.email=a.c_user_email,s.phone=a.c_user_phone,s.agreed_amount=a.agreed_amount,s.address=a.c_user_address,d.value=!0},q=a=>{g.value.id=a.id,s.id=a.id,s.name=a.c_user_name,m.value=!0},L=async()=>{if(s.id){c.value=!0;try{const a=await V(`/collage_ap/${p.value}/user/${s.id}`,{method:"DELETE"});a?.success?(f.add({title:"Success",description:a?.msg||"User deleted successfully",color:"success",duration:2e3}),await h(),s.id="",s.name="",m.value=!1):(f.add({description:a?.msg||a?.message||a?._data?.msg||"Failed to delete user. Please try again later.",color:"error",duration:2e3}),m.value=!1)}catch(a){console.error("Delete failed:",a),f.add({title:"Error",description:"Something went wrong. Please try again later.",color:"error",duration:2e3})}finally{c.value=!1,m.value=!1}}},O=[{accessorKey:"c_user_name",header:"Name",cell:({row:a})=>y(le,{to:`/users/${a.original.id}?collegeId=${p.value}&name=${a.original.c_user_name}`,class:"text-primary hover:underline cursor-pointer"},()=>a.original.c_user_name)},{accessorKey:"c_user_email",header:"Email"},{accessorKey:"c_user_phone",header:"Phone No."},{accessorKey:"c_user_address",header:"Address"},{accessorKey:"agreed_amount",header:"Agreed Amount"},{id:"actions",header:"Actions",cell:({row:a})=>y("div",{class:"flex gap-2 items-center"},[y(z,{text:"Edit User"},{default:()=>y(N,{icon:"i-heroicons-pencil-square",size:"xs",color:"success",variant:"soft",onClick:()=>M(a.original)})}),y(z,{text:"Delete User"},{default:()=>y(N,{icon:"i-heroicons-trash",size:"xs",color:"error",variant:"soft",onClick:()=>q(a.original)})})])}],h=async()=>{x.value=!0;try{const a=await V(`/collage_ap/${p.value}/users`);a?.success?(k.value=!0,C.value=a?.c_users):a?.success||(k.value=!1,D.value=a?.msg||"Org not found")}catch(a){console.error("Error fetching projects:",a)}finally{x.value=!1}},R=P(()=>{if(!_.value)return C.value;const a=_.value.toLowerCase();return C.value.filter(e=>e.c_user_name?.toLowerCase().includes(a)||e.c_user_email?.toLowerCase().includes(a)||e.c_user_phone?.includes(a))});return Y(p,async a=>{a&&await h()}),Z(async()=>{p.value&&await h()}),(a,e)=>{const A=re,n=N,v=de,G=ie,H=ue,w=ne,J=te,F=ce;return $(),S(ae,null,[i("div",fe,[l(x)?($(),S("div",pe,[o(A,{"show-loader":l(x),size:"md"},null,8,["show-loader"])])):l(k)?($(),ee(H,{key:1,class:"w-full"},{header:r(()=>[i("div",_e,[i("div",ge,[e[14]||(e[14]=i("h2",{class:"text-xl font-bold"},"Users",-1)),o(n,{color:"primary",icon:"i-lucide-plus",class:"flex sm:hidden",onClick:e[0]||(e[0]=()=>{E(),d.value=!0})},{default:r(()=>e[13]||(e[13]=[b(" Add User ",-1)])),_:1,__:[13]})]),i("div",ve,[o(v,{modelValue:l(_),"onUpdate:modelValue":e[2]||(e[2]=t=>j(_)?_.value=t:null),icon:"i-lucide-search",size:"md",variant:"outline",placeholder:"Search...",class:"w-full sm:w-fit",ui:{trailing:"pe-1"}},se({_:2},[l(_)?.length?{name:"trailing",fn:r(()=>[o(n,{color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x","aria-label":"Clear input",onClick:e[1]||(e[1]=t=>_.value="")})]),key:"0"}:void 0]),1032,["modelValue"]),o(n,{color:"primary",icon:"i-lucide-plus",class:"sm:flex hidden",onClick:e[3]||(e[3]=()=>{E(),d.value=!0})},{default:r(()=>e[15]||(e[15]=[b(" Add User ",-1)])),_:1,__:[15]})])])]),default:r(()=>[o(G,{data:l(R),columns:O,loading:l(x),class:"flex-1"},null,8,["data","loading"])]),_:1})):($(),S("div",ye,T(l(D)),1))]),o(F,{open:l(d),"onUpdate:open":e[10]||(e[10]=t=>j(d)?d.value=t:null),title:l(g).id?"Edit User":"Create User",dismissible:!1},{body:r(()=>[o(J,{schema:l(I),state:l(s),class:"space-y-4",onSubmit:K},{default:r(()=>[i("div",be,[o(w,{label:"Name",name:"name"},{default:r(()=>[o(v,{modelValue:l(s).name,"onUpdate:modelValue":e[4]||(e[4]=t=>l(s).name=t),placeholder:"Enter Name",class:"w-full"},null,8,["modelValue"])]),_:1}),o(w,{label:"Email",name:"email"},{default:r(()=>[o(v,{modelValue:l(s).email,"onUpdate:modelValue":e[5]||(e[5]=t=>l(s).email=t),placeholder:"Enter Email",class:"w-full"},null,8,["modelValue"])]),_:1}),o(w,{label:"Phone",name:"phone"},{default:r(()=>[o(v,{modelValue:l(s).phone,"onUpdate:modelValue":e[6]||(e[6]=t=>l(s).phone=t),placeholder:"Enter Phone Number",class:"w-full"},null,8,["modelValue"])]),_:1}),o(w,{label:"Address",name:"address"},{default:r(()=>[o(v,{modelValue:l(s).address,"onUpdate:modelValue":e[7]||(e[7]=t=>l(s).address=t),placeholder:"Enter Address",class:"w-full"},null,8,["modelValue"])]),_:1}),o(w,{label:"Agreed Amount",name:"agreed_amount"},{default:r(()=>[o(v,{modelValue:l(s).agreed_amount,"onUpdate:modelValue":e[8]||(e[8]=t=>l(s).agreed_amount=t),type:"number",placeholder:"Enter Agreed Amount",class:"w-full"},null,8,["modelValue"])]),_:1})]),i("div",xe,[o(n,{label:"Cancel",color:"neutral",variant:"outline",onClick:e[9]||(e[9]=t=>d.value=!1)}),o(n,{type:"submit",loading:l(c),disabled:l(c),label:l(g).id?"Update":"Create"},null,8,["loading","disabled","label"])])]),_:1},8,["schema","state"])]),_:1},8,["open","title"]),o(F,{open:l(m),"onUpdate:open":e[12]||(e[12]=t=>j(m)?m.value=t:null),title:"Confirm Delete",dismissible:!1},{body:r(()=>[i("p",we,[e[16]||(e[16]=b(" Are you sure you want to delete this ",-1)),i("strong",null,T(l(s)&&l(s).name),1),e[17]||(e[17]=b(" user? This action cannot be undone. ",-1))]),i("div",Ue,[o(n,{color:"neutral",variant:"outline",onClick:e[11]||(e[11]=t=>m.value=!1)},{default:r(()=>e[18]||(e[18]=[b(" Cancel ",-1)])),_:1,__:[18]}),o(n,{color:"error",variant:"solid",onClick:L,loading:l(c),disabled:l(c)},{default:r(()=>e[19]||(e[19]=[b(" Delete ",-1)])),_:1,__:[19]},8,["loading","disabled"])])]),_:1},8,["open"])],64)}}};export{Ae as default};
